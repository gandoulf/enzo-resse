<!DOCTYPE HTML>
<html lang="en" class="ayu" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Network - Layered Fog Of War documentation</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('ayu')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../documentation.html">Documentation</a></li><li class="chapter-item expanded "><a href="../../book/index.html">Book</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../book/getting_started.html">Getting Started</a></li><li class="chapter-item expanded "><a href="../../book/architecture/index.html">Architecture</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../book/architecture/Handler.html">Handler</a></li><li class="chapter-item expanded "><a href="../../book/architecture/Floor.html">Floor</a></li><li class="chapter-item expanded "><a href="../../book/architecture/Layers.html">Layers</a></li><li class="chapter-item expanded "><a href="../../book/architecture/Network.html" class="active">Network</a></li></ol></li><li class="chapter-item expanded "><a href="../../book/Template/index.html">Template</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../book/Template/MOBA.html">MOBA Template</a></li></ol></li><li class="chapter-item expanded "><a href="../../book/Tutorials/index.html">Tutorials</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../book/Tutorials/First_set_up.html">First set up</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/entities/index.html">Entities</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../book/Tutorials/entities/Collision_Entity.html">Collision entity</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/entities/Drawing_Entity.html">Drawing entity</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/entities/Visibility_Entity.html">Visibility Entity</a></li></ol></li><li class="chapter-item expanded "><a href="../../book/Tutorials/Rendering/index.html">Rendering</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../book/Tutorials/Rendering/HeatTexture.html">Heat Texture</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/Rendering/Material.html">Post Process</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/Rendering/MaterialOpacity.html">Material Opacity</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/Rendering/Stencil.html">Stencil</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/Rendering/SubFogTexture.html">Sub Fog Texture</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/Rendering/Teams.html">Teams</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/Rendering/ToggleRender.html">Toggle Render</a></li></ol></li><li class="chapter-item expanded "><a href="../../book/Tutorials/FogChannels.html">Fog Channels</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/Floor_Verticality.html">Floor and Verticality</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/Layers.html">Layers</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/Minimap.html">Minimap</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/Navigation.html">Navigation</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/Networking.html">Networking</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/Outdoor_Indoor.html">Outdoor Indoor</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/PluginAPI.html">PluginAPI</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/StealthArea.html">Stealth Area</a></li></ol></li><li class="chapter-item expanded "><a href="../../book/Versions/index.html">Versions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../book/Versions/LFOW_V1.1.1.html">LFOW V1.1.1</a></li><li class="chapter-item expanded "><a href="../../book/Versions/LFOW_V1.2.0.html">LFOW V1.2.0</a></li><li class="chapter-item expanded "><a href="../../book/Versions/LFOW_V1.2.1.html">LFOW V1.2.1</a></li><li class="chapter-item expanded "><a href="../../book/Versions/LFOW_V1.3.0.html">LFOW V1.3.0</a></li><li class="chapter-item expanded "><a href="../../book/Versions/LFOW_V1.3.1.html">LFOW V1.3.1</a></li><li class="chapter-item expanded "><a href="../../book/Versions/LFOW_V1.4.0.html">LFOW V1.4.0</a></li><li class="chapter-item expanded "><a href="../../book/Versions/LFOW_V1.4.1.html">LFOW V1.4.1</a></li><li class="chapter-item expanded "><a href="../../book/Versions/LFOW_V1.4.2.html">LFOW V1.4.2</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../reference.html">C++ API Reference</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../reference/classes.html">Classes</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../reference/classes/AFOW_Handler.html">AFOW_Handler</a></li><li class="chapter-item expanded "><a href="../../reference/classes/IFOW_CollisionEntity_Interface.html">IFOW_CollisionEntity_Interface</a></li><li class="chapter-item expanded "><a href="../../reference/classes/IFOW_DrawingEntity_Interface.html">IFOW_DrawingEntity_Interface</a></li><li class="chapter-item expanded "><a href="../../reference/classes/IFOW_Entity_Interface.html">IFOW_Entity_Interface</a></li><li class="chapter-item expanded "><a href="../../reference/classes/IFOW_GeometryEntity_Interface.html">IFOW_GeometryEntity_Interface</a></li><li class="chapter-item expanded "><a href="../../reference/classes/IFOW_VisibilityEntity_Interface.html">IFOW_VisibilityEntity_Interface</a></li><li class="chapter-item expanded "><a href="../../reference/classes/UFOW_CollisionHandler.html">UFOW_CollisionHandler</a></li><li class="chapter-item expanded "><a href="../../reference/classes/UFOW_DrawerComponent.html">UFOW_DrawerComponent</a></li><li class="chapter-item expanded "><a href="../../reference/classes/UFOW_Drawer_Shared.html">UFOW_Drawer_Shared</a></li><li class="chapter-item expanded "><a href="../../reference/classes/UFOW_EntityContainer.html">UFOW_EntityContainer</a></li><li class="chapter-item expanded "><a href="../../reference/classes/UFOW_EntityVisibilityHandler.html">UFOW_EntityVisibilityHandler</a></li><li class="chapter-item expanded "><a href="../../reference/classes/UFOW_Floor.html">UFOW_Floor</a></li><li class="chapter-item expanded "><a href="../../reference/classes/UFOW_LayerHandler.html">UFOW_LayerHandler</a></li><li class="chapter-item expanded "><a href="../../reference/classes/UFOW_LayerSetting.html">UFOW_LayerSetting</a></li><li class="chapter-item expanded "><a href="../../reference/classes/UFOW_Rasterizer.html">UFOW_Rasterizer</a></li><li class="chapter-item expanded "><a href="../../reference/classes/UFOW_TextureSample.html">UFOW_TextureSample</a></li><li class="chapter-item expanded "><a href="../../reference/classes/UFOW_VisibilityE_Component.html">UFOW_VisibilityE_Component</a></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Layered Fog Of War documentation</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="network"><a class="header" href="#network">Network</a></h1>
<h2 id="table-of-contents"><a class="header" href="#table-of-contents">Table of contents</a></h2>
<ul>
<li><a href="#explanation">Explanation</a>
<ul>
<li><a href="#network-settings">Network Settings</a></li>
<li><a href="#fog-state-replication">Fog State Replication</a>
<ul>
<li><a href="#server">Server</a></li>
<li><a href="#client">Client</a></li>
</ul>
</li>
<li><a href="#networking-diagram">Networking Diagram</a></li>
</ul>
</li>
<li><a href="#what-is-replicated">What is Replicated</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
<h2 id="explanation"><a class="header" href="#explanation">Explanation</a></h2>
<p>The <code>Layered Fog of War</code> is ready for online games but requires a good understanding of the <code>replication</code> provided by Unreal,
and how the <code>LFOW</code> uses it. To begin with, the <code>Fog State</code> isn't replicated; it can be synchronized to the client, but the
<code>LFOW</code> will never continually send fog data over the network.</p>
<p>The <code>LFOW</code> relies on the <code>simulation</code>, ensuring the state of the <code>server</code> and the <code>client</code> remains the same as long as the
position of the drawer is replicated and correctly updated. In case of latency or client disconnection, the <code>LFOW</code> server can,
as mentioned earlier, synchronize and send the fog state through <code>RPC</code> to the <code>clients</code>.</p>
<p>The plugin includes the concept of <code>teams</code>, which can be seen as data duplication. If the <code>LFOW</code> is set up with 2 channels and
3 teams, it will use 6 channels internally. Currently, it can only manage up to 8 channels, which means a maximum of 4 teams
with 2 channels each.</p>
<p>However, many games don't need to synchronize the <code>Fog State</code> and rely only on the <code>simulation</code>. MOBA games like <code>League of  Legends</code> or <code>Dota</code> will only use a single channel to represent what is currently visible. For games using such a setup, the
team limit disappears.<br /></p>
<p>See the <a href="/book/architecture/"></a><a href="../Tutorials/Networking.html">Networking turorial</a> for implementation.</p>
<h3 id="network-settings"><a class="header" href="#network-settings">Network Settings</a></h3>
<p>The <code>UFOW_NetworkSettings</code> class is designed to override the <code>FOWHandler</code> variables for online games and set up different
behaviors depending on the <code>Net Status</code>. <code>Server</code>, <code>Client</code>, and <code>Spectators</code> require more or less data to be computed by the
<code>LFOW</code>. For example, a <code>Client</code> only needs to compute the state of its team since it should never see what the opponent sees.
However, the <code>Server</code> needs to store the state of each team in case of client re-synchronization.</p>
<h3 id="fog-state-replication"><a class="header" href="#fog-state-replication">Fog State Replication</a></h3>
<p><code>AFOW_FogStateReplication</code> is the base class for every <code>Online</code> game instance implementing the <code>LFOW</code>. The server will have
its own class and will spawn a new one for every client. It will manage the network used by the plugin, handle connection and
disconnection, and provide useful <code>RPC</code> to synchronize every game instance. For now, it will only attribute a <code>Team ID</code> to
every client which is <code>replicated</code> and provide methods to synchronize the Fog through <code>RPC</code> if needed.</p>
<h4 id="server"><a class="header" href="#server">Server</a></h4>
<p><code>AFOW_FogStateReplication_Server</code> handles all client connections and provides a <code>Team ID</code> to every <code>AFOW_FogStateReplication_Client</code>.
To gain full control of the IDs distributed, you can override <code>GetClientTeamIndex</code>, allowing you to return any value. See the
<code>Networking</code> tutorial for more information. If the fog is replicated, be aware that any team ID higher than the maximum team limit won't work.<br />
You will find two multicast methods that I've written as examples. I'm not sure of their efficiency, so please don't use them:</p>
<ul>
<li><code>MulticastRPC_AddDrawer</code>, deprecated</li>
<li><code>MulticastRPC_RemoveDrawer</code>, deprecated</li>
</ul>
<h4 id="client"><a class="header" href="#client">Client</a></h4>
<p><code>AFOW_FogStateReplication_Client</code> lets you override a few methods to insert or call whatever you want between the connection steps.
The <code>ServerRPC_RequestFogStateSynch</code> RPC lets you request the server to synchronize the fog state if replication has been enabled
in the network settings. You will find a few parameters to manage automatic synchronization or the cooldown time between requests:</p>
<ul>
<li><code>MinimumTimePerFrameBeforeSynch</code>: The refresh rate threshold in ms before the automatic request of the FOW sync to the server.
Set a large timer if you don't want automatic sync.</li>
<li><code>SynchRequestCooldown</code>: Cooldown to prevent the client from DDOSing the server.</li>
</ul>
<h3 id="networking-diagram"><a class="header" href="#networking-diagram">Networking Diagram</a></h3>
<p>Here is a simple representation of the plugin network layer. All red nodes represent networking events triggered by RPC or replication.
On the left of the <code>On Login</code> event are represented the server execution of a client, on the right the client one.</p>
<p><img src="../../assets/Architecture/Network/0_NetworkInitDiagram.png" alt="Network update pipeline" /></p>
<h2 id="what-is-replicated"><a class="header" href="#what-is-replicated">What is Replicated</a></h2>
<p>Since the fog state is not continuously replicated but merely synchronized and then simulated, you might wonder what is actually
replicated. Only two concepts use replication to allow a fast implementation of the plugin:</p>
<ul>
<li><code>Client Team ID</code>: This important value is used to request the correct fog channels from the <code>Server</code> when synchronization is required.
It is also necessary to attribute a <code>team ID</code> to anything modifying the fog.</li>
<li><code>Drawing Components Team ID</code>: Every drawing component's team ID will be replicated and can be changed by the server without worrying about the network stack.</li>
</ul>
<h2 id="conclusion"><a class="header" href="#conclusion">Conclusion</a></h2>
<p>The <code>LFOW</code> plugin replication implementation is very lightweight and doesn't provide much assistance for the development of
online games. The main reason for this light implementation is to avoid overloading the bandwidth and to prevent forcing its
use, as many games like <code>RTS</code> use <code>simulation</code> to avoid the <code>replication</code> of thousands of units. This means that <code>developers</code> will
need to implement events themselves to control the status of the <code>Components</code> and <code>Entities</code>.</p>
<hr />
<p><em>Documentation built with <a href="https://github.com/PsichiX/unreal-doc"><strong><code>Unreal-Doc</code> v1.0.9</strong></a> tool by <a href="https://github.com/PsichiX"><strong><code>PsichiX</code></strong></a></em></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../book/architecture/Layers.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../book/Template/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../book/architecture/Layers.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../book/Template/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
