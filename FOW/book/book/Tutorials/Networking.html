<!DOCTYPE HTML>
<html lang="en" class="ayu" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Networking - Layered Fog Of War documentation</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('ayu')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../documentation.html">Documentation</a></li><li class="chapter-item expanded "><a href="../../book/index.html">Book</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../book/getting_started.html">Getting Started</a></li><li class="chapter-item expanded "><a href="../../book/architecture/index.html">Architecture</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../book/architecture/Handler.html">Handler</a></li><li class="chapter-item expanded "><a href="../../book/architecture/Floor.html">Floor</a></li></ol></li><li class="chapter-item expanded "><a href="../../book/Tutorials/index.html">Tutorials</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../book/Tutorials/First_set_up.html">First set up</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/entities/index.html">Entities</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../book/Tutorials/entities/Visibility_Entity.html">Visibility entity</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/entities/Drawing_Entity.html">Drawing entity</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/entities/Collision_Entity.html">Collision entity</a></li></ol></li><li class="chapter-item expanded "><a href="../../book/Tutorials/Layers.html">Layers</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/Outdoor_Indoor.html">Outdoor Indoor</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/Networking.html" class="active">Networking</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/FogChannels.html">Fog Channels</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/Floor_Verticality.html">Floor and verticality</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/Minimap.html">Minimap</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../reference.html">C++ API Reference</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../reference/classes.html">Classes</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../reference/classes/AFOW_Handler.html">AFOW_Handler</a></li><li class="chapter-item expanded "><a href="../../reference/classes/IFOW_CollisionEntity_Interface.html">IFOW_CollisionEntity_Interface</a></li><li class="chapter-item expanded "><a href="../../reference/classes/IFOW_DrawingEntity_Interface.html">IFOW_DrawingEntity_Interface</a></li><li class="chapter-item expanded "><a href="../../reference/classes/IFOW_Entity_Interface.html">IFOW_Entity_Interface</a></li><li class="chapter-item expanded "><a href="../../reference/classes/IFOW_GeometryEntity_Interface.html">IFOW_GeometryEntity_Interface</a></li><li class="chapter-item expanded "><a href="../../reference/classes/IFOW_VisibilityEntity_Interface.html">IFOW_VisibilityEntity_Interface</a></li><li class="chapter-item expanded "><a href="../../reference/classes/UFOW_CollisionHandler.html">UFOW_CollisionHandler</a></li><li class="chapter-item expanded "><a href="../../reference/classes/UFOW_DrawerComponent.html">UFOW_DrawerComponent</a></li><li class="chapter-item expanded "><a href="../../reference/classes/UFOW_Drawer_Shared.html">UFOW_Drawer_Shared</a></li><li class="chapter-item expanded "><a href="../../reference/classes/UFOW_EntityContainer.html">UFOW_EntityContainer</a></li><li class="chapter-item expanded "><a href="../../reference/classes/UFOW_EntityVisibilityHandler.html">UFOW_EntityVisibilityHandler</a></li><li class="chapter-item expanded "><a href="../../reference/classes/UFOW_Floor.html">UFOW_Floor</a></li><li class="chapter-item expanded "><a href="../../reference/classes/UFOW_LayerHandler.html">UFOW_LayerHandler</a></li><li class="chapter-item expanded "><a href="../../reference/classes/UFOW_LayerSetting.html">UFOW_LayerSetting</a></li><li class="chapter-item expanded "><a href="../../reference/classes/UFOW_Rasterizer.html">UFOW_Rasterizer</a></li><li class="chapter-item expanded "><a href="../../reference/classes/UFOW_TextureSample.html">UFOW_TextureSample</a></li><li class="chapter-item expanded "><a href="../../reference/classes/UFOW_Tile_Class.html">UFOW_Tile_Class</a></li><li class="chapter-item expanded "><a href="../../reference/classes/UFOW_VisibilityE_Component.html">UFOW_VisibilityE_Component</a></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Layered Fog Of War documentation</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="networking"><a class="header" href="#networking">Networking</a></h1>
<ul>
<li><a href="#default-replication-setup">Default replication setup</a></li>
<li><a href="#manage-player-team">Manage player team</a></li>
<li><a href="#infinit-team">Infinit team</a></li>
</ul>
<blockquote>
<p><strong>/!\ This tutorial is made to show how the FOW works with networks, replication knowledge
won't be providen. Networking <code>GameMode</code>, <code>GameState</code>, <code>Controller</code> and <code>Character</code> are providen.
You have obsolutly the right to read, copy and use any code you find :) <br /></strong></p>
</blockquote>
<p>This tutorial has been realised in the Tutorial/Maps/TutorialMap_Networking map providen in the
<a href="https://github.com/gandoulf/LayeredFOW_Demo">Demo Project</a></p>
<h1 id="default-replication-setup"><a class="header" href="#default-replication-setup">Default replication setup</a></h1>
<p>The <code>TutorialMap_Networking</code> has been set up to show you how replication and teams works. To do
so a <code>BP_TutoralNetworking_GameMode</code> has been set up with a <code>BP_TutorialNetworking_PlayerController</code>
to spawn a <code>BP_TutorialNetworking_Character</code> at a <code>PlayerStart</code>location depending of the Client team.<br />
To visualize the replication the server will clear the fog of an another spawn point for each team
before the client connection. <br /></p>
<ul>
<li>The circle represent the spawn point</li>
<li>The square is the associated revealed spawn point</li>
</ul>
<p><img src="../../assets/Tutorial/Network/0_NetworkingMapSetup.png" alt="Networking" /></p>
<p>There is a little trouble with Unreal and singleton instance when they are stored in a static variable.
If you hit the play button with multiple player in the editor, multiple world will be created but inside the
same application, wich means static variable are shared and overriden. To prevent this the FOW is designed to
look for an implementation of <code>FOW_GetHandlerInstance_Interface</code> in the <code>GameState</code>.<br /></p>
<p>Let's setup the game state. Create a new <code>My_FOWNetworking_GameState</code> derived from <code>GameStateBase</code></p>
<p><img src="../../assets/Tutorial/Network/1_CreateNewGameState.png" alt="Networking" /></p>
<p>Open it and go into <code>ClassSettings</code> to add the <code>FOW_GetHandlerInstance_Interface</code> in the <code>ImplementedInterfaces</code>
array.</p>
<p><img src="../../assets/Tutorial/Network/2_AddGetHandlerInterface.png" alt="Networking" /></p>
<p>Now you have to provide the code to the <code>Find_Level_FOWHandler</code>.</p>
<ul>
<li>Add a <code>FOW_Handler</code> variable</li>
<li>Get the variable and convert it to a <code>Validate</code> get, if valide return the variable.</li>
<li>Else find all actor of class <code>FOW_Handler</code></li>
<li>If at least one is retruned, set your <code>FOW_Handler</code> variable to the first element of the array</li>
<li>Return the variable</li>
</ul>
<p><img src="../../assets/Tutorial/Network/3_AddCodeToTheInterfaceMethod.png" alt="Networking" /></p>
<p>Now open the <code>BP_TutoralNetworking_GameMode</code> and replace the <code>GameState</code> with yours</p>
<p><img src="../../assets/Tutorial/Network/4_ChangeDefaultGameState.png" alt="Networking" /></p>
<p>All set up !</p>
<blockquote>
<p><strong>Note that if you don't simulate the network in the editor this whole setting
isn't needed, as long as every game instance are separated process you don't need to implemente
the interface.</strong></p>
</blockquote>
<p>Now let's see how the FOW works with replication. First create a new <code>BP_MyNetworkSettings</code>
derived from <code>UFOW_NetworkSettings</code>.</p>
<p><img src="../../assets/Tutorial/Network/5_MakeNetworkSettingClass.png" alt="Networking" /></p>
<p>Open it and change the <code>NetworkGameMaxTeamNbr</code> value from the <code>Server</code> to 4. It means
that the <code>FOW_Handler</code> will be ready to handle 4 different teams drawing fog seperatly.
(for few reason 4 team with two channels enable is the maximum). Also if you pay attention
the client is set to only one team, which mean that only the client team fog will be updated.<br />
Under those settings you will find check box to allow or not replication and which channel are replicated.
The first channel isn't needed since it represent the fog of what drawers currently see.</p>
<p><img src="../../assets/Tutorial/Network/6_SetUpTheLayerSettings.png" alt="Networking" /></p>
<p>Select the <code>BP_FOW_Handler</code>, get into the details panel and change the <code>NetworkSettingsClass</code> to
your <code>BP_MyNetworkSettings</code>.</p>
<p><img src="../../assets/Tutorial/Network/6.1_ChangeFOWHandlerNetworkSettings.png" alt="Networking" /></p>
<p>Before hitting the play button change the <code>PlaySettings</code>. Change the number of players to 4
and change <code>NetMode</code> to <code>PlayAsListenServer</code>.</p>
<p><img src="../../assets/Tutorial/Network/7_ChangeTheEditorPlaySettings.png" alt="Networking" /></p>
<p>Now you can hit the play button and see the 4 windows open which your character connecting one by one.
If you do not understand what the fog replication change, go back to your <code>BP_MyNetworkSettings</code> and
uncheck <code>bIsFogStateReplicated</code>.</p>
<p><img src="../../assets/Tutorial/Network/8_NetworkingResult.png" alt="Networking" /></p>
<h1 id="manage-player-team"><a class="header" href="#manage-player-team">Manage player team</a></h1>
<p>The previous part was about to setup the network over the FOW. However you couldn't do anything
regarding which client are associated to which team because of the default system distributing the
players to each team.</p>
<p>Let's see how to do that. Create a <code>BP_MyFogStateReplication_Server</code> derived from <code>AFOW_FogStateReplication_Server</code>.</p>
<p><img src="../../assets/Tutorial/Network/9_CreateNewFogStateReplication.png" alt="Networking" /></p>
<p>Open it and override the <code>GetClientTeamIndex</code> function.</p>
<p><img src="../../assets/Tutorial/Network/10_OpenAndOverrideGetClientTeamIndex.png" alt="Networking" /></p>
<p>Open it. This is where you can manage the client team association. the <code>PlayerController</code> is providen,
You should be able to fetch necessary data from your game with it.
For the example let's just do this:</p>
<ul>
<li>Get the <code>NetworkMaxTeamNbr</code> and substract 1 from it</li>
<li>Pin the result to a <code>Radom Integer in Range</code></li>
<li>Pin the result to the return;</li>
</ul>
<p><img src="../../assets/Tutorial/Network/11_AddCustomCodeToGetClientTeamIndex.png" alt="Networking" /></p>
<p>Now that the server is set up, open your <code>BP_MyNetworkSettings</code> and replace the <code>FogStateReplicationClass</code>
by your <code>BP_MyFogStateReplication_Server</code>.</p>
<p><img src="../../assets/Tutorial/Network/12_ChangeFogStateReplicationClassServer.png" alt="Networking" /></p>
<p>Hit the Play button and see the player beeing associated to a random team !</p>
<h1 id="infinit-team"><a class="header" href="#infinit-team">Infinit team</a></h1>
<p>In case you want more than 4 team with two channel you can just uncheck <code>bIsFogStateReplicated</code>,
Set the <code>NetworkGameMaxTeamNbr</code> for both client and server to 1 and provide any team index you
want in the <code>GetClientTeamIndex</code> override.</p>
<blockquote>
<p><strong>This replicated team number issue will be taken care of, it might not allow infinit number but more
than 4 for sure</strong></p>
</blockquote>
<p><img src="../../assets/Tutorial/Network/13_InfinitTeamForNonReplicatedFog.png" alt="Networking" /></p>
<hr />
<p><em>Documentation built with <a href="https://github.com/PsichiX/unreal-doc"><strong><code>Unreal-Doc</code> v1.0.9</strong></a> tool by <a href="https://github.com/PsichiX"><strong><code>PsichiX</code></strong></a></em></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../book/Tutorials/Outdoor_Indoor.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../book/Tutorials/FogChannels.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../book/Tutorials/Outdoor_Indoor.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../book/Tutorials/FogChannels.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
