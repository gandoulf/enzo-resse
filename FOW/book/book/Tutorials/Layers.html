<!DOCTYPE HTML>
<html lang="en" class="ayu" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Layers - Layered Fog Of War documentation</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('ayu')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../documentation.html">Documentation</a></li><li class="chapter-item expanded "><a href="../../book/index.html">Book</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../book/getting_started.html">Getting Started</a></li><li class="chapter-item expanded "><a href="../../book/architecture/index.html">Architecture</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../book/architecture/Handler.html">Handler</a></li><li class="chapter-item expanded "><a href="../../book/architecture/Floor.html">Floor</a></li><li class="chapter-item expanded "><a href="../../book/architecture/Layers.html">Layers</a></li><li class="chapter-item expanded "><a href="../../book/architecture/Network.html">Network</a></li></ol></li><li class="chapter-item expanded "><a href="../../book/Template/index.html">Template</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../book/Template/MOBA.html">MOBA Template</a></li></ol></li><li class="chapter-item expanded "><a href="../../book/Tutorials/index.html">Tutorials</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../book/Tutorials/First_set_up.html">First set up</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/entities/index.html">Entities</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../book/Tutorials/entities/Collision_Entity.html">Collision entity</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/entities/Drawing_Entity.html">Drawing entity</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/entities/Visibility_Entity.html">Visibility Entity</a></li></ol></li><li class="chapter-item expanded "><a href="../../book/Tutorials/Rendering/index.html">Rendering</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../book/Tutorials/Rendering/HeatTexture.html">Heat Texture</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/Rendering/Material.html">Material</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/Rendering/Teams.html">Teams</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/Rendering/ToggleRender.html">Toggle Render</a></li></ol></li><li class="chapter-item expanded "><a href="../../book/Tutorials/FogChannels.html">Fog Channels</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/Floor_Verticality.html">Floor and Verticality</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/Layers.html" class="active">Layers</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/Minimap.html">Minimap</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/Networking.html">Networking</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/Outdoor_Indoor.html">Outdoor Indoor</a></li><li class="chapter-item expanded "><a href="../../book/Tutorials/StealthArea.html">Stealth Area</a></li></ol></li><li class="chapter-item expanded "><a href="../../book/Versions/index.html">Versions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../book/Versions/LFOW_V1.1.1.html">LFOW V1.1.1</a></li><li class="chapter-item expanded "><a href="../../book/Versions/LFOW_V1.2.0.html">LFOW V1.2.0</a></li><li class="chapter-item expanded "><a href="../../book/Versions/LFOW_V1.2.1.html">LFOW V1.2.1</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../reference.html">C++ API Reference</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../reference/classes.html">Classes</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../reference/classes/AFOW_Handler.html">AFOW_Handler</a></li><li class="chapter-item expanded "><a href="../../reference/classes/IFOW_CollisionEntity_Interface.html">IFOW_CollisionEntity_Interface</a></li><li class="chapter-item expanded "><a href="../../reference/classes/IFOW_DrawingEntity_Interface.html">IFOW_DrawingEntity_Interface</a></li><li class="chapter-item expanded "><a href="../../reference/classes/IFOW_Entity_Interface.html">IFOW_Entity_Interface</a></li><li class="chapter-item expanded "><a href="../../reference/classes/IFOW_GeometryEntity_Interface.html">IFOW_GeometryEntity_Interface</a></li><li class="chapter-item expanded "><a href="../../reference/classes/IFOW_VisibilityEntity_Interface.html">IFOW_VisibilityEntity_Interface</a></li><li class="chapter-item expanded "><a href="../../reference/classes/UFOW_CollisionHandler.html">UFOW_CollisionHandler</a></li><li class="chapter-item expanded "><a href="../../reference/classes/UFOW_DrawerComponent.html">UFOW_DrawerComponent</a></li><li class="chapter-item expanded "><a href="../../reference/classes/UFOW_Drawer_Shared.html">UFOW_Drawer_Shared</a></li><li class="chapter-item expanded "><a href="../../reference/classes/UFOW_EntityContainer.html">UFOW_EntityContainer</a></li><li class="chapter-item expanded "><a href="../../reference/classes/UFOW_EntityVisibilityHandler.html">UFOW_EntityVisibilityHandler</a></li><li class="chapter-item expanded "><a href="../../reference/classes/UFOW_Floor.html">UFOW_Floor</a></li><li class="chapter-item expanded "><a href="../../reference/classes/UFOW_LayerHandler.html">UFOW_LayerHandler</a></li><li class="chapter-item expanded "><a href="../../reference/classes/UFOW_LayerSetting.html">UFOW_LayerSetting</a></li><li class="chapter-item expanded "><a href="../../reference/classes/UFOW_Rasterizer.html">UFOW_Rasterizer</a></li><li class="chapter-item expanded "><a href="../../reference/classes/UFOW_TextureSample.html">UFOW_TextureSample</a></li><li class="chapter-item expanded "><a href="../../reference/classes/UFOW_Tile_Class.html">UFOW_Tile_Class</a></li><li class="chapter-item expanded "><a href="../../reference/classes/UFOW_VisibilityE_Component.html">UFOW_VisibilityE_Component</a></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Layered Fog Of War documentation</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="layers"><a class="header" href="#layers">Layers</a></h1>
<ul>
<li><a href="#create-and-add-layers">Create and Add Layers</a></li>
<li><a href="#static-layers-and-optimization">Static Layers and Optimization</a></li>
</ul>
<p>For this tutorial use <code>Tutorial/Maps/TutorialMap</code> or <code>Tutorial/Maps/TutorialMap_Collider</code> map provided in
the <a href="https://github.com/gandoulf/LayeredFOW_Demo">Demo Project</a></p>
<h2 id="create-and-add-layers"><a class="header" href="#create-and-add-layers">Create and Add Layers</a></h2>
<p>This part will explain how <code>LayerSettings</code> work and how you can create new ones for your games. First, you have
to know that they are dissociated to provide different information to the FOW but also to provide a computation
order during the fog fragment merging. It can be compared to a rendering pipeline. To register a new layer, you
will have to create a <code>LayerHandler</code>.</p>
<p>Let's try to change the behavior of the drawer on your character. We want him to reveal only the black fog but
not to give him sight.</p>
<p>Create a new BP_MyLayerHandler derived from <code>FOW_LayerHandler</code></p>
<p><img src="../../assets/Tutorial/Layers/1_CreateLayerHandler_BP.png" alt="Create Layer Handler BP" /></p>
<p>Create a new BP_MyFOVLayer derived from <code>FOW_LayerSettings</code></p>
<p><img src="../../assets/Tutorial/Layers/2_CreateLayerSetting_BP.png" alt="Create Layer Setting BP" /></p>
<p>Open your layer handler and add the new layer you've just created. Add it just under the <code>FOW_FOVLayer</code></p>
<p><img src="../../assets/Tutorial/Layers/3_OpenAndAddNewLayerSetting.png" alt="Open And Add New Layer Setting" /></p>
<p>Now we need to tell the <code>FOW_Handler</code> that we are using a new layer pipeline. Select the <code>BP_FOW_Handler</code> and
change in the details panel, in the class section, the value of the <code>LayerHandlerClass</code> to the one you've created</p>
<p><img src="../../assets/Tutorial/Layers/4_ChangeTheLayerHandler.png" alt="Change The Layer Handler" /></p>
<p>Open the blueprint holding the <code>FOVDrawer</code>, select it and go to the detail panel. Scroll to the <code>LayerSettingClass</code>
and replace it with the one you've created</p>
<p><img src="../../assets/Tutorial/Layers/5_ReplaceTheLayerSettingClass.png" alt="Replace The Layer Setting Class" /></p>
<p>Now that everything is correctly set, we can change the behavior of the <code>LayerSetting</code>. Open the blueprint, turn
the <code>InverseBits</code> to true (I'm going to ask you to trust me on that, every FOV Layers will need this to be true)
and set the <code>RevealSight</code> to false and <code>RevealFog</code> to true. Doing so will prevent the player from having sight
on <code>VisibilityEntity</code> however the layout will be revealed</p>
<p><img src="../../assets/Tutorial/Layers/6_ChangeLayerSettings.png" alt="Change Layer Settings" /></p>
<p>Enjoy your new layer setting! Check out the <a href="/book/Tutorials/Visibility_entity.html">Visibility Entity page</a> to really understand
the difference between <code>RevealSight</code> and <code>RevealFog</code>.</p>
<p><img src="../../assets/Tutorial/Layers/7_PiercingOnlySightFog.png" alt="Piercing Only Sight Fog" /></p>
<h2 id="static-layers-and-optimization"><a class="header" href="#static-layers-and-optimization">Static Layers and Optimization</a></h2>
<p>The FOW is a heavy piece of code to update and optimization is present almost everywhere. Sadly optimization can
have counterparts. Static layers can be really interesting to reduce the computation time; it will prevent the
re-generation of a fog fragment (heaviest update) if the drawer and the entities bound to it haven't moved.</p>
<p>The plugin uses static layers only for collision; geometry will be collected and drawn into a fog fragment and be
merged with other fragments during every update. Doing so prevents the sight drawing from using the whole collider
vertices to cast shadow.</p>
<p>To enable this optimization first open your <code>LayerHandler</code> and check the <code>DrawFOWCollider</code> box.</p>
<p><img src="../../assets/Tutorial/Layers/8_LayerHandlerDrawCollider.png" alt="Layer Handler Draw Collider" /></p>
<blockquote>
<p><strong>Caution, this optimization is really effective for colliders if the owning actor is static.</strong></p>
</blockquote>
<p>This setting provides the possibility for every collider to send its geometry to a <code>SharedDrawer</code>. By default,
every collider is set to do so. You can disable this feature by unchecking <code>ShouldBeDrawn</code> from the <code>CollisionEntity</code>.</p>
<p><img src="../../assets/Tutorial/Layers/9_DisableColliderEntityDrawing.png" alt="Disable Collider Entity Drawing" /></p>
<p>If the colliders are drawn, the collision shadow will remain even if the collider isn't in sight. <code>ShouldBeDrawn</code>
is enabled on the left and disabled on the right.</p>
<p><img src="../../assets/Tutorial/Layers/10_CollisionDrawing.png" alt="Collision Drawing" /></p>
<p>It might sound weak as an optimization since there are only 4 vertices in a rectangle. But if you multiply the few
triangles by the number of colliders and by the number of AI, we're talking about milliseconds saved by the update.
It's even more effective for custom collision with a lot of vertices.</p>
<hr />
<p><em>Documentation built with <a href="https://github.com/PsichiX/unreal-doc"><strong><code>Unreal-Doc</code> v1.0.9</strong></a> tool by <a href="https://github.com/PsichiX"><strong><code>PsichiX</code></strong></a></em></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../book/Tutorials/Floor_Verticality.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../book/Tutorials/Minimap.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../book/Tutorials/Floor_Verticality.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../book/Tutorials/Minimap.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
